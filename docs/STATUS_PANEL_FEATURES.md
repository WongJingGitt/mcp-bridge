# 状态面板增强功能说明

## 🎯 新增功能

### 1. 🖱️ **可拖拽移动**
- **拖拽方式**：鼠标按住面板头部（标题区域）拖动
- **位置记忆**：松开后自动保存位置到 localStorage
- **下次打开**：自动恢复到上次的位置
- **边界限制**：不会被拖出屏幕外

**使用场景**：当浮窗挡住页面重要内容时，可以拖到其他角落

---

### 2. 🔽 **最小化功能**
- **触发方式**：点击头部的"最小化"按钮（横线图标）
- **最小化样式**：收缩成圆形图标（64x64px）
- **状态指示**：
  - 🔵 **蓝色旋转环**：正在执行工具调用
  - 🟢 **绿色环**：执行成功
  - 🔴 **红色环**：执行失败
  - ⚪ **无环**：闲置状态
- **恢复方式**：点击最小化图标即可展开

**使用场景**：长时间不需要查看状态时，最小化节省屏幕空间

---

### 3. 👻 **半透明闲置模式**
- **触发条件**：5秒无鼠标操作自动变半透明（opacity: 0.5）
- **恢复条件**：
  - 鼠标移入面板
  - 工具调用开始执行
- **自动行为**：执行时自动恢复 100% 不透明度

**使用场景**：浮窗常驻时减少视觉干扰，执行时自动显现

---

### 4. 🚀 **智能自动展开**
- **触发条件**：检测到工具调用开始执行
- **自动行为**：
  - 从最小化状态自动展开
  - 从半透明状态恢复不透明
  - 确保用户能看到执行过程

**使用场景**：最小化后仍能及时看到工具调用状态

---

## 🎨 尺寸调整

### 面板尺寸
- **原始宽度**：380px
- **新宽度**：440px（增加 60px）
- **最小化尺寸**：64x64px 圆形

### 布局优化
- 更宽的文本显示区域
- 更舒适的按钮间距
- 更清晰的内容层次

---

## 📍 位置保存机制

### localStorage 键名
```
mcp-bridge-panel-position
```

### 数据格式
```json
{
  "left": 100,
  "top": 200
}
```

### 加载逻辑
1. 首次打开：默认右下角（bottom: 20px, right: 20px）
2. 拖拽后：保存 `left` 和 `top`，禁用 `bottom` 和 `right`
3. 下次打开：读取 localStorage，应用保存的位置

---

## 🎮 操作指南

### 拖拽移动
1. 鼠标移到面板头部（标题区域）
2. 按住左键不放
3. 移动到目标位置
4. 松开鼠标，位置自动保存

### 最小化/恢复
- **最小化**：点击头部右侧的"—"图标
- **恢复**：点击最小化后的圆形图标

### 折叠/展开
- **功能**：只折叠内容区，保留标题栏
- **触发**：点击"∨"图标
- **区别**：不同于最小化，仍保持矩形面板

---

## 💡 使用建议

### 推荐配置
1. **日常使用**：拖到不挡住常用区域的角落
2. **长期挂机**：最小化到角落，执行时自动展开
3. **专注模式**：折叠内容区，只看标题状态

### 快捷操作组合
- **快速隐藏**：最小化 → 自动半透明
- **完全展开**：点击最小化图标 → 自动恢复所有状态
- **只看状态**：折叠内容区 → 保留标题栏的状态指示器

---

## 🔧 技术实现

### 拖拽
- 监听 `mousedown` → `mousemove` → `mouseup`
- 计算偏移量 + 边界限制
- 动态修改 `style.left` 和 `style.top`

### 最小化
- CSS 类 `.minimized` 控制样式
- `::before` 伪元素绘制状态环
- CSS 动画实现旋转效果

### 闲置检测
- `setInterval` 每 2 秒检查一次
- 记录 `lastActiveTime`，超过 5 秒添加 `.idle` 类
- 鼠标事件触发 `markActive()` 刷新时间

### 位置持久化
- `localStorage.setItem()` 保存
- `localStorage.getItem()` 读取
- JSON 序列化/反序列化

---

## 🐛 注意事项

1. **拖拽范围**：只在标题区域有效，不包括按钮
2. **最小化状态**：点击整个圆形图标都会恢复
3. **位置保存**：刷新页面后自动恢复位置
4. **多标签页**：每个标签页的面板位置独立
5. **响应式**：`max-width: calc(100vw - 40px)` 适配窄屏

---

## 🎯 后续优化方向

- [ ] 添加位置预设（4个角落快速切换）
- [ ] 双击标题栏回到默认位置
- [ ] 拖拽时显示吸附辅助线
- [ ] 移动端触摸拖拽支持
- [ ] 主题颜色自定义
