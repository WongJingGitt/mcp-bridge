# 服务管理界面新功能说明

## 新增功能

在 MCP Bridge 的服务管理页面中，为每个服务添加了以下功能：

### 1. 实时状态指示器

每个服务现在会显示实时运行状态：

- 🟢 **运行中** (绿色) - 服务正常运行，可以正常调用
- ⚪ **已停止** (灰色) - 服务未运行或已被禁用
- 🔴 **异常** (红色) - 服务运行异常或出现错误
- ⚪ **检测中...** (灰色脉动) - 正在检测服务状态

### 2. 重启按钮

每个服务旁边都有一个 **🔄 重启** 按钮，可以：
- 单独重启某个出问题的服务
- 不影响其他正在运行的服务
- 点击后显示 "⏳ 重启中..." 状态
- 重启完成后自动刷新状态

## 界面布局

```
┌─────────────────────────────────────────────────────────────────┐
│ 服务名称                                                          │
│ 服务描述文字...                                                   │
│                                                                   │
│              [🟢 运行中]  [🔄 重启]  [开关]                        │
└─────────────────────────────────────────────────────────────────┘
```

## 技术实现

### 状态检测
- 直接调用本地 API: `GET http://localhost:3849/tools?serverName={服务名}`
- 如果返回成功且有工具列表，显示"运行中"
- 如果返回 404，显示"已停止"
- 如果无法连接，显示"未运行"
- 如果出现其他错误，显示"异常"

### 重启功能
- 直接调用本地 API: `POST http://localhost:3849/restart-server`
- 请求体: `{ "serverName": "服务名" }`
- 重启成功后，延迟 1 秒重新检测状态
- 显示友好的成功/失败提示

## 使用场景

### 场景 1: 服务出现异常
1. 看到某个服务状态显示 🔴 **异常**
2. 点击该服务的 **🔄 重启** 按钮
3. 等待重启完成
4. 状态自动更新为 🟢 **运行中**

### 场景 2: 修改了服务配置
1. 在配置文件中修改了某个服务的参数
2. 只需要重启该服务，而不是所有服务
3. 点击该服务的 **🔄 重启** 按钮
4. 新配置生效

### 场景 3: 检查服务状态
1. 打开服务管理页面
2. 自动检测所有服务的运行状态
3. 一目了然地看到哪些服务在运行，哪些已停止

## API 端点使用

### 状态检测
```javascript
GET http://localhost:3849/tools?serverName=Knowledge%20Graph%20Memory%20Server

响应 (成功):
{
  "success": true,
  "tools": [...]
}

响应 (未运行):
404 Not Found
{
  "detail": "服务 xxx 不存在或未成功加载"
}
```

### 重启服务
```javascript
POST http://localhost:3849/restart-server
Content-Type: application/json

{
  "serverName": "Knowledge Graph Memory Server"
}

响应 (成功):
{
  "success": true,
  "message": "服务 Knowledge Graph Memory Server 已重启",
  "toolCount": 9
}

响应 (失败):
{
  "success": false,
  "detail": "错误信息"
}
```

## 样式说明

### 状态指示器颜色
- 运行中: `#22c55e` (绿色) + 发光效果
- 已停止: `#9ca3af` (灰色)
- 异常: `#ef4444` (红色) + 发光效果
- 检测中: `#9ca3af` (灰色) + 脉动动画

### 重启按钮
- 默认: 浅灰背景 `#f6f8fa`
- 悬停: 稍深灰色 `#eef1f4`
- 禁用: 透明度 60%
- 点击: 轻微缩小效果

## 注意事项

1. **直接 API 调用**: 
   - 不通过 background.js，直接调用本地服务 API
   - 需要确保 MCP Bridge Server 在 3849 端口运行

2. **状态刷新**:
   - 每次打开服务管理页面时自动检测
   - 重启服务后自动刷新状态
   - 不会自动轮询（避免不必要的请求）

3. **错误处理**:
   - 网络错误会显示"未运行"状态
   - 重启失败会有明确的错误提示
   - 所有操作都有友好的用户反馈

## 优势

✅ **实时状态** - 直观显示每个服务的运行状态  
✅ **快速操作** - 一键重启问题服务  
✅ **独立控制** - 重启单个服务不影响其他服务  
✅ **友好反馈** - 清晰的状态指示和操作提示  
✅ **高性能** - 直接 API 调用，响应快速  

## 后续优化建议

1. 可以添加定时自动刷新状态（可选）
2. 可以添加批量重启功能
3. 可以显示服务的更多信息（工具数量、运行时间等）
4. 可以添加服务日志查看功能
